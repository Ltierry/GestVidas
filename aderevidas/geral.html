<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesouraria - Dashboard Integrado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* Header e Navegação */
        header {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }
        
        .header-title {
            font-size: 22px;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info span {
            margin-right: 15px;
        }
        
        .logout-btn, .back-btn {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 10px;
        }
        
        .logout-btn:hover, .back-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Conteúdo Principal */
        .main-content {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .page-title {
            color: #1a2a6c;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
        }
        
        .filter-control {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 16px;
        }
        
        .saldo-positivo {
            color: #28a745;
        }
        
        .saldo-negativo {
            color: #dc3545;
        }
        
        .entrada {
            color: #28a745;
        }
        
        .saida {
            color: #dc3545;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .card-title {
            color: #1a2a6c;
            font-size: 20px;
        }
        
        .see-all {
            color: #1a2a6c;
            text-decoration: none;
            font-weight: 600;
        }
        
        .see-all:hover {
            text-decoration: underline;
        }
        
        .movements-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .movements-table th {
            background-color: #f8f9fa;
            color: #1a2a6c;
            font-weight: 600;
            padding: 12px 15px;
            text-align: left;
            border-bottom: 2px solid #eee;
        }
        
        .movements-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .movements-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .movement-type {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .type-entrada {
            background-color: #d4edda;
            color: #155724;
        }
        
        .type-saida {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .type-dizimo {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .type-oferta {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .type-transferencia {
            background-color: #d6d8db;
            color: #383d41;
        }
        
        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #1a2a6c;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Footer */
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 50px;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .logo-container {
                margin-bottom: 15px;
            }
            
            .user-info {
                flex-direction: column;
                margin-top: 15px;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .movements-table {
                display: block;
                overflow-x: auto;
            }
            
            .page-title {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-container">
                <img src="https://i.ibb.co/Ng3DKmJK/logo-igreja.png" alt="Logo Igreja" class="logo">
                <div class="header-title">Tesouraria - Igreja Adere Vidas</div>
            </div>
            <div class="user-info">
                <span id="current-filial-info">Filial: Carregando...</span>
                <button class="back-btn" onclick="window.location.href='main.html'"><i class="fas fa-arrow-left"></i> Voltar</button>
                <button class="logout-btn">Sair <i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>
    </header>
    
    <div class="main-content">
        <div class="page-title">
            <h1>Dashboard da Tesouraria</h1>
            <div>
                <button class="logout-btn" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i> Atualizar
                </button>
            </div>
        </div>
        
        <div class="filters">
            <div class="filter-group">
                <label for="data-inicio">Data Início</label>
                <input type="date" id="data-inicio" class="filter-control">
            </div>
            
            <div class="filter-group">
                <label for="data-fim">Data Fim</label>
                <input type="date" id="data-fim" class="filter-control">
            </div>
            
            <div class="filter-group">
                <label for="tipo-movimento">Tipo de Movimento</label>
                <select id="tipo-movimento" class="filter-control">
                    <option value="todos">Todos</option>
                    <option value="entrada">Entradas</option>
                    <option value="saida">Saídas</option>
                    <option value="dizimo">Dízimos</option>
                    <option value="oferta">Ofertas</option>
                    <option value="transferencia">Transferências</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>&nbsp;</label>
                <button class="logout-btn" id="aplicar-filtros">
                    <i class="fas fa-filter"></i> Aplicar Filtros
                </button>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="stat-card">
                <div class="stat-icon" style="color: #1a2a6c;">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="stat-number" id="saldo-total">R$ 0,00</div>
                <div class="stat-label">Saldo Total</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon entrada">
                    <i class="fas fa-sign-in-alt"></i>
                </div>
                <div class="stat-number entrada" id="total-entradas">R$ 0,00</div>
                <div class="stat-label">Total Entradas</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon saida">
                    <i class="fas fa-sign-out-alt"></i>
                </div>
                <div class="stat-number saida" id="total-saidas">R$ 0,00</div>
                <div class="stat-label">Total Saídas</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #17a2b8;">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <div class="stat-number" id="total-dizimos">R$ 0,00</div>
                <div class="stat-label">Total Dízimos</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #ffc107;">
                    <i class="fas fa-donate"></i>
                </div>
                <div class="stat-number" id="total-ofertas">R$ 0,00</div>
                <div class="stat-label">Total Ofertas</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #6f42c1;">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="stat-number" id="total-transferencias">R$ 0,00</div>
                <div class="stat-label">Total Transferências</div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Histórico de Movimentos</h2>
                <a href="#" class="see-all">Ver relatório completo</a>
            </div>
            
            <div id="loading-movimentos" class="loading">
                <div class="loading-spinner"></div>
            </div>
            
            <table class="movements-table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Descrição</th>
                        <th>Tipo</th>
                        <th>Detalhes</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody id="movimentos-list">
                    <!-- Movimentos serão carregados aqui -->
                </tbody>
            </table>
            
            <div id="empty-movimentos" style="display: none; text-align: center; padding: 20px; color: #666;">
                <i class="fas fa-exchange-alt" style="font-size: 40px; margin-bottom: 15px; color: #ddd;"></i>
                <p>Nenhum movimento encontrado</p>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Sistema de Gestão - Igreja Adere Vidas &copy; 2025</p>
    </footer>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBNmIm9kem9yKp9skGS2HKHwqaauK36aps",
            authDomain: "dbaderevidas-9cbd0.firebaseapp.com",
            projectId: "dbaderevidas-9cbd0",
            storageBucket: "dbaderevidas-9cbd0.firebasestorage.app",
            messagingSenderId: "762500930740",
            appId: "1:762500930740:web:ff13ea2685e2db28ec0be1"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Estado da aplicação
        let currentFilial = null;
        let currentUser = null;
        let allMovements = [];
        
        // Elementos da interface
        const currentFilialInfo = document.getElementById('current-filial-info');
        const saldoTotalEl = document.getElementById('saldo-total');
        const totalEntradasEl = document.getElementById('total-entradas');
        const totalSaidasEl = document.getElementById('total-saidas');
        const totalDizimosEl = document.getElementById('total-dizimos');
        const totalOfertasEl = document.getElementById('total-ofertas');
        const totalTransferenciasEl = document.getElementById('total-transferencias');
        const movimentosList = document.getElementById('movimentos-list');
        const loadingMovimentos = document.getElementById('loading-movimentos');
        const emptyMovimentos = document.getElementById('empty-movimentos');
        const dataInicioEl = document.getElementById('data-inicio');
        const dataFimEl = document.getElementById('data-fim');
        const tipoMovimentoEl = document.getElementById('tipo-movimento');
        const aplicarFiltrosBtn = document.getElementById('aplicar-filtros');
        const refreshBtn = document.getElementById('refresh-btn');
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se o usuário está logado
            const userData = sessionStorage.getItem('user');
            
            if (!userData) {
                window.location.href = 'index.html';
                return;
            }
            
            currentUser = JSON.parse(userData);
            
            // Obter a filial atual da URL ou localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const filialId = urlParams.get('filial') || localStorage.getItem('currentFilialId');
            
            if (filialId) {
                loadFilialInfo(filialId);
            } else {
                currentFilialInfo.textContent = 'Filial: Não selecionada';
                // Definir datas padrão e carregar dados mesmo sem filial
                setupDefaultDates();
                setupEventListeners();
            }
        });
        
        // Carregar informações da filial
        async function loadFilialInfo(filialId) {
            try {
                const filialDoc = await db.collection('filiais').doc(filialId).get();
                if (filialDoc.exists) {
                    currentFilial = filialDoc.data();
                    currentFilial.id = filialId;
                    currentFilialInfo.textContent = `Filial: ${currentFilial.congregacao}`;
                } else {
                    currentFilialInfo.textContent = 'Filial: Não encontrada';
                }
                
                // Definir datas padrão e carregar dados após carregar a filial
                setupDefaultDates();
                setupEventListeners();
            } catch (error) {
                console.error('Erro ao carregar informações da filial:', error);
                currentFilialInfo.textContent = 'Filial: Erro ao carregar';
                setupDefaultDates();
                setupEventListeners();
            }
        }
        
        // Configurar datas padrão
        function setupDefaultDates() {
            const hoje = new Date();
            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            
            dataInicioEl.value = primeiroDiaMes.toISOString().split('T')[0];
            dataFimEl.value = hoje.toISOString().split('T')[0];
            
            // Carregar dados do dashboard
            loadDashboardData();
        }
        
        // Configurar eventos
        function setupEventListeners() {
            // Logout
            document.querySelector('.logout-btn').addEventListener('click', function() {
                if(confirm('Deseja realmente sair do sistema?')) {
                    sessionStorage.removeItem('user');
                    localStorage.removeItem('currentFilialId');
                    window.location.href = 'index.html';
                }
            });
            
            // Botão atualizar
            refreshBtn.addEventListener('click', function() {
                loadDashboardData();
            });
            
            // Aplicar filtros
            aplicarFiltrosBtn.addEventListener('click', function() {
                loadDashboardData();
            });
        }
        
        // Formatar valor monetário
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }
        
        // Carregar dados do dashboard
        async function loadDashboardData() {
    try {
        loadingMovimentos.style.display = 'flex';
        movimentosList.innerHTML = '';
        
        // Obter filtros
        const dataInicio = dataInicioEl.value ? new Date(dataInicioEl.value) : null;
        const dataFim = dataFimEl.value ? new Date(dataFimEl.value) : null;
        const tipoMovimento = tipoMovimentoEl.value;
        
        // Verificar se há uma filial selecionada
        if (!currentFilial || !currentFilial.id) {
            showEmptyMovimentos();
            updateDashboard([], tipoMovimento);
            loadingMovimentos.style.display = 'none';
            return;
        }
        
        // Carregar movimentos APENAS da filial atual
        const [
            dizimosSnapshot, 
            ofertasSnapshot, 
            entradasSnapshot, 
            saidasSnapshot, 
            transferenciasSnapshot
        ] = await Promise.all([
            db.collection('dizimos')
                .where('filialId', '==', currentFilial.id)
                .get(),
            db.collection('ofertas')
                .where('filialId', '==', currentFilial.id)
                .get(),
            db.collection('entradas')
                .where('filialId', '==', currentFilial.id)
                .get(),
            db.collection('saidas')
                .where('filialId', '==', currentFilial.id)
                .get(),
            db.collection('transferencias')
                .where('origemId', '==', currentFilial.id)
                .get()
        ]);
        
        const movements = [];
        
        // Processar dízimos da filial
        if (!dizimosSnapshot.empty) {
            dizimosSnapshot.forEach(doc => {
                const movement = {
                    id: doc.id,
                    ...doc.data(),
                    tipo: 'dizimo',
                    colecao: 'dizimos'
                };
                movements.push(movement);
            });
        }
        
        // Processar ofertas da filial
        if (!ofertasSnapshot.empty) {
            ofertasSnapshot.forEach(doc => {
                const movement = {
                    id: doc.id,
                    ...doc.data(),
                    tipo: 'oferta',
                    colecao: 'ofertas'
                };
                movements.push(movement);
            });
        }
        
        // Processar entradas da filial
        if (!entradasSnapshot.empty) {
            entradasSnapshot.forEach(doc => {
                const movement = {
                    id: doc.id,
                    ...doc.data(),
                    tipo: 'entrada',
                    colecao: 'entradas'
                };
                movements.push(movement);
            });
        }
        
        // Processar saídas da filial
        if (!saidasSnapshot.empty) {
            saidasSnapshot.forEach(doc => {
                const movement = {
                    id: doc.id,
                    ...doc.data(),
                    tipo: 'saida',
                    colecao: 'saidas'
                };
                movements.push(movement);
            });
        }
        
        // Processar transferências da filial (tanto como origem quanto destino)
        if (!transferenciasSnapshot.empty) {
            transferenciasSnapshot.forEach(doc => {
                const movement = {
                    id: doc.id,
                    ...doc.data(),
                    tipo: 'transferencia',
                    colecao: 'transferencias'
                };
                movements.push(movement);
            });
        }
        
        // Também buscar transferências onde a filial é DESTINO
        const transferenciasDestinoSnapshot = await db.collection('transferencias')
            .where('destinoId', '==', currentFilial.id)
            .get();
            
        if (!transferenciasDestinoSnapshot.empty) {
            transferenciasDestinoSnapshot.forEach(doc => {
                const movement = {
                    id: doc.id,
                    ...doc.data(),
                    tipo: 'transferencia',
                    colecao: 'transferencias'
                };
                movements.push(movement);
            });
        }
        
        if (movements.length === 0) {
            updateDashboard([], tipoMovimento);
            showEmptyMovimentos();
            loadingMovimentos.style.display = 'none';
            return;
        }
        
        allMovements = movements;
        updateDashboard(movements, tipoMovimento);
        
    } catch (error) {
        console.error('Erro ao carregar dados do dashboard:', error);
        loadingMovimentos.style.display = 'none';
    }
}
        
        // Atualizar dashboard com os dados
        function updateDashboard(movements, tipoFiltro) {
    // Aplicar filtro de tipo
    let filteredMovements = movements;
    if (tipoFiltro !== 'todos') {
        filteredMovements = movements.filter(m => m.tipo === tipoFiltro);
    }
    
    // Aplicar filtro de data se especificado
    const dataInicio = dataInicioEl.value ? new Date(dataInicioEl.value) : null;
    const dataFim = dataFimEl.value ? new Date(dataFimEl.value) : null;
    
    if (dataInicio && dataFim) {
        filteredMovements = filteredMovements.filter(movement => {
            const movementDate = movement.data ? new Date(movement.data) : 
                             movement.createdAt ? movement.createdAt.toDate() : new Date(0);
            return movementDate >= dataInicio && movementDate <= dataFim;
        });
    }
    
    // Calcular totais ESPECÍFICOS da filial
    let totalEntradas = 0;
    let totalSaidas = 0;
    let totalDizimos = 0;
    let totalOfertas = 0;
    let totalTransferenciasEnviadas = 0;
    let totalTransferenciasRecebidas = 0;
    
    filteredMovements.forEach(movement => {
        const valor = movement.valor || 0;
        
        if (movement.tipo === 'entrada') {
            totalEntradas += valor;
        } else if (movement.tipo === 'saida') {
            totalSaidas += valor;
        } else if (movement.tipo === 'dizimo') {
            totalDizimos += valor;
            totalEntradas += valor; // Dízimos também são entradas
        } else if (movement.tipo === 'oferta') {
            totalOfertas += valor;
            totalEntradas += valor; // Ofertas também são entradas
        } else if (movement.tipo === 'transferencia') {
            // Verificar se a transferência é ENVIADA ou RECEBIDA
            if (movement.origemId === currentFilial.id) {
                totalTransferenciasEnviadas += valor;
                totalSaidas += valor; // Transferências enviadas são saídas
            } else if (movement.destinoId === currentFilial.id) {
                totalTransferenciasRecebidas += valor;
                totalEntradas += valor; // Transferências recebidas são entradas
            }
        }
    });
    
    const totalTransferencias = totalTransferenciasEnviadas + totalTransferenciasRecebidas;
    const saldoTotal = totalEntradas - totalSaidas;
    
    // Atualizar estatísticas
    saldoTotalEl.textContent = formatarMoeda(saldoTotal);
    saldoTotalEl.className = 'stat-number ' + (saldoTotal >= 0 ? 'saldo-positivo' : 'saldo-negativo');
    
    totalEntradasEl.textContent = formatarMoeda(totalEntradas);
    totalSaidasEl.textContent = formatarMoeda(totalSaidas);
    totalDizimosEl.textContent = formatarMoeda(totalDizimos);
    totalOfertasEl.textContent = formatarMoeda(totalOfertas);
    totalTransferenciasEl.textContent = formatarMoeda(totalTransferencias);
    
    // Exibir movimentos
    displayMovimentos(filteredMovements);
}
        
        // Exibir movimentos na tabela
        function displayMovimentos(movements) {
    loadingMovimentos.style.display = 'none';
    
    if (movements.length === 0) {
        showEmptyMovimentos();
        return;
    }
    
    emptyMovimentos.style.display = 'none';
    
    // Ordenar por data (mais recente primeiro)
    movements.sort((a, b) => {
        const dataA = new Date(a.data || a.createdAt?.toDate() || 0);
        const dataB = new Date(b.data || b.createdAt?.toDate() || 0);
        return dataB - dataA;
    });
    
    // Limitar a 15 movimentos
    const limitedMovements = movements.slice(0, 15);
    
    // Exibir movimentos
    limitedMovements.forEach(movement => {
        const data = movement.data ? new Date(movement.data) : 
                  movement.createdAt ? movement.createdAt.toDate() : new Date();
        
        const dataFormatada = data.toLocaleDateString('pt-BR');
        const valor = movement.valor || 0;
        
        // Determinar descrição e detalhes com base no tipo
        let descricao = '';
        let detalhes = '';
        let tipoClasse = '';
        let tipoTexto = '';
        
        switch(movement.tipo) {
            case 'entrada':
                descricao = movement.descricao || 'Entrada financeira';
                detalhes = movement.categoria ? `Categoria: ${movement.categoria}` : '';
                tipoClasse = 'type-entrada';
                tipoTexto = 'Entrada';
                break;
            case 'saida':
                descricao = movement.descricao || 'Saída financeira';
                detalhes = movement.categoria ? `Categoria: ${movement.categoria}` : '';
                if (movement.fornecedor) {
                    detalhes += movement.categoria ? ` | Fornecedor: ${movement.fornecedor}` : `Fornecedor: ${movement.fornecedor}`;
                }
                tipoClasse = 'type-saida';
                tipoTexto = 'Saída';
                break;
            case 'dizimo':
                descricao = `Dízimo - ${movement.membroNome || 'Membro'}`;
                detalhes = movement.periodo ? `Período: ${movement.periodo}` : '';
                if (movement.competencia) {
                    detalhes += movement.periodo ? ` | Competência: ${movement.competencia}` : `Competência: ${movement.competencia}`;
                }
                tipoClasse = 'type-dizimo';
                tipoTexto = 'Dízimo';
                break;
            case 'oferta':
                descricao = movement.descricao || 'Oferta';
                detalhes = movement.tipo ? `Tipo: ${movement.tipo}` : '';
                tipoClasse = 'type-oferta';
                tipoTexto = 'Oferta';
                break;
            case 'transferencia':
                // Verificar se é transferência enviada ou recebida
                if (movement.origemId === currentFilial.id) {
                    descricao = `Transferência ENVIADA para ${movement.destinoNome}`;
                    tipoClasse = 'type-saida';
                    tipoTexto = 'Transf. Enviada';
                } else {
                    descricao = `Transferência RECEBIDA de ${movement.origemNome}`;
                    tipoClasse = 'type-entrada';
                    tipoTexto = 'Transf. Recebida';
                }
                detalhes = movement.motivo || '';
                if (movement.tipo) {
                    detalhes += movement.motivo ? ` | Tipo: ${movement.tipo}` : `Tipo: ${movement.tipo}`;
                }
                break;
            default:
                descricao = movement.descricao || 'Movimento financeiro';
                tipoClasse = 'type-entrada';
                tipoTexto = 'Entrada';
        }
        
        const tr = document.createElement('tr');
        
        tr.innerHTML = `
            <td>${dataFormatada}</td>
            <td>${descricao}</td>
            <td><span class="movement-type ${tipoClasse}">${tipoTexto}</span></td>
            <td>${detalhes}</td>
            <td style="font-weight: 600; color: ${movement.tipo === 'saida' || (movement.tipo === 'transferencia' && movement.origemId === currentFilial.id) ? '#dc3545' : '#28a745'}">
                ${formatarMoeda(valor)}
            </td>
        `;
        
        movimentosList.appendChild(tr);
    });
}
        
        // Mostrar mensagem quando não houver movimentos
        function showEmptyMovimentos() {
            emptyMovimentos.style.display = 'block';
        }
    </script>
</body>
</html>