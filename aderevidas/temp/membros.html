<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Membros - Igreja Adere Vidas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* Header e Navegação */
        header {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }
        
        .header-title {
            font-size: 22px;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info span {
            margin-right: 15px;
        }
        
        .logout-btn {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Menu de Navegação */
        nav {
            background-color: #2c3e50;
            padding: 0 20px;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .menu {
            list-style-type: none;
            display: flex;
        }
        
        .menu-item {
            position: relative;
        }
        
        .menu-item > a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            transition: background-color 0.3s;
        }
        
        .menu-item > a:hover {
            background-color: #34495e;
        }
        
        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: white;
            min-width: 200px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-radius: 0 0 5px 5px;
            display: none;
            z-index: 10;
        }
        
        .dropdown-item {
            display: block;
            padding: 12px 20px;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s;
        }
        
        .dropdown-item:hover {
            background-color: #f0f0f0;
        }
        
        .menu-item:hover .dropdown {
            display: block;
        }
        
        /* Conteúdo Principal */
        .main-content {
            max-width: 1600px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .page-title {
            color: #1a2a6c;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, #24378a, #c52d2d);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* Abas */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 600;
            color: #555;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            color: #1a2a6c;
            border-bottom: 3px solid #1a2a6c;
        }
        
        .tab:hover {
            color: #1a2a6c;
        }
        
        .pending-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ffc107;
            color: #856404;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Tabela de membros */
        .members-table-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .members-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .members-table th {
            background-color: #f8f9fa;
            color: #1a2a6c;
            font-weight: 600;
            padding: 15px;
            text-align: left;
            border-bottom: 2px solid #eee;
        }
        
        .members-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }
        
        .members-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .member-photo-cell {
            width: 80px;
            text-align: center;
        }
        
        .member-photo-small {
            width: 60px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .member-photo-small:hover {
            transform: scale(1.8);
            z-index: 10;
            position: relative;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-view {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .btn-view:hover {
            background-color: #bbdefb;
        }
        
        .btn-edit {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .btn-edit:hover {
            background-color: #ffe0b2;
        }
        
        .btn-deactivate {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .btn-deactivate:hover {
            background-color: #ffcdd2;
        }
        
        .btn-activate {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .btn-activate:hover {
            background-color: #c8e6c9;
        }
        
        .btn-delete {
            background-color: #fbe9e7;
            color: #d84315;
        }
        
        .btn-delete:hover {
            background-color: #ffccbc;
        }
        
        .btn-accept {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .btn-accept:hover {
            background-color: #c8e6c9;
        }
        
        .btn-reject {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .btn-reject:hover {
            background-color: #ffcdd2;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-ativo {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-pendente {
            background-color: #fff8e1;
            color: #f57f17;
        }
        
        .status-desligado {
            background-color: #ffebee;
            color: #c62828;
        }
        
        /* Seção de Carteirinhas */
        .card-generation {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: #1a2a6c;
            outline: none;
        }
        
        .selected-members-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .selected-member {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .selected-member:hover {
            background-color: #e9ecef;
        }
        
        .remove-member {
            background: none;
            border: none;
            color: #b21f1f;
            cursor: pointer;
            font-size: 16px;
        }
        
        .search-results {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
            z-index: 100;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .search-result-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .search-result-item:hover {
            background-color: #f0f0f0;
        }
        
        /* Modal de visualização de membro */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            color: #1a2a6c;
            font-size: 20px;
            font-weight: 600;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .member-details-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .member-photo-large {
            width: 100%;
            max-width: 200px;
            border-radius: 8px;
            border: 2px solid #ddd;
        }
        
        .details-section {
            margin-bottom: 20px;
        }
        
        .details-section h3 {
            color: #1a2a6c;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 8px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #555;
            min-width: 150px;
        }
        
        .detail-value {
            color: #333;
            flex: 1;
        }
        
        /* Alertas */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #1a2a6c;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Footer */
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 50px;
        }
        
        /* Responsividade */
        @media (max-width: 1024px) {
            .members-table {
                display: block;
                overflow-x: auto;
            }
            
            .member-details-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .logo-container {
                margin-bottom: 15px;
            }
            
            .menu {
                flex-direction: column;
            }
            
            .dropdown {
                position: static;
                width: 100%;
                display: none;
                box-shadow: none;
                border-radius: 0;
            }
            
            .menu-item:hover .dropdown {
                display: none;
            }
            
            .menu-item.active .dropdown {
                display: block;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                text-align: center;
                padding: 10px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-container">
                <img src="https://i.ibb.co/Ng3DKmJK/logo-igreja.png" alt="Logo Igreja" class="logo">
                <div class="header-title">Igreja Adere Vidas</div>
            </div>
            <div class="user-info">
                <span id="header-username">Bem-vindo, Administrador</span>
                <button class="logout-btn">Sair <i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>
    </header>
    
    <nav>
        <div class="nav-container">
            <ul class="menu">
                <li class="menu-item">
                    <a href="main.html"><i class="fas fa-home"></i> Início</a>
                </li>
                <li class="menu-item">
                    <a href="#"><i class="fas fa-church"></i> Ministérios</a>
                </li>
                <li class="menu-item">
                    <a href="#"><i class="fas fa-calendar-alt"></i> Eventos</a>
                </li>
                <li class="menu-item">
                    <a href="membros.html"><i class="fas fa-users"></i> Membros</a>
                </li>
                <li class="menu-item">
                    <a href="#"><i class="fas fa-file-alt"></i> Relatórios</a>
                </li>
                <li class="menu-item">
                    <a href="#"><i class="fas fa-cogs"></i> Configurações</a>
                </li>
                <li class="menu-item">
                    <a href="#"><i class="fas fa-database"></i> Cadastro <i class="fas fa-chevron-down"></i></a>
                    <div class="dropdown">
                        <a href="add_usuario.html" class="dropdown-item"><i class="fas fa-user"></i> Usuário</a>
                        <a href="perfil.html" class="dropdown-item"><i class="fas fa-id-card"></i> Perfil</a>
                        <a href="add_filiais.html" class="dropdown-item"><i class="fas fa-church"></i> Filiais</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    
    <div class="main-content">
        <div class="page-title">
            <h1>Gerenciamento de Membros</h1>
            <button class="btn btn-primary" id="add-member-btn">
                <i class="fas fa-plus"></i> Cadastrar Membro
            </button>
        </div>
        
        <div class="alert alert-success" id="success-alert">
            <i class="fas fa-check-circle"></i> <span id="success-message"></span>
        </div>
        
        <div class="alert alert-error" id="error-alert">
            <i class="fas fa-exclamation-circle"></i> <span id="error-message"></span>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="ativos">Ativos</div>
            <div class="tab" data-tab="desligados">Desligados</div>
            <div class="tab" data-tab="carteirinhas">Carteirinhas</div>
             <div class="tab" data-tab="pendentes">Solicitações <span id="pending-count" class="pending-badge">0</span></div>
        </div>
        
        <div class="loading" id="loading-members">
            <div class="loading-spinner"></div>
            <p>Carregando membros...</p>
        </div>
        
        <div class="tab-content active" id="ativos-content">
            <div class="members-table-container">
                <table class="members-table">
                    <thead>
                        <tr>
                            <th class="member-photo-cell">Foto</th>
                            <th>Nome</th>
                            <th>ID</th>
                            <th>Telefone</th>
                            <th>E-mail</th>
                            <th>Congregação</th>
                            <th>Cargo</th>
                            <th>Data Entrada</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="ativos-list">
                        <!-- Membros ativos serão carregados aqui -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="pendentes-content">
            <div class="members-table-container">
                <table class="members-table">
                    <thead>
                        <tr>
                            <th class="member-photo-cell">Foto</th>
                            <th>Nome</th>
                            <th>ID</th>
                            <th>Telefone</th>
                            <th>E-mail</th>
                            <th>Congregação</th>
                            <th>Cargo</th>
                            <th>Data Entrada</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="pendentes-list">
                        <!-- Membros pendentes serão carregados aqui -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="desligados-content">
            <div class="members-table-container">
                <table class="members-table">
                    <thead>
                        <tr>
                            <th class="member-photo-cell">Foto</th>
                            <th>Nome</th>
                            <th>ID</th>
                            <th>Telefone</th>
                            <th>E-mail</th>
                            <th>Congregação</th>
                            <th>Cargo</th>
                            <th>Data Entrada</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="desligados-list">
                        <!-- Membros desligados serão carregados aqui -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="carteirinhas-content">
            <div class="card-generation">
                <h2>Gerar Carteirinhas</h2>
                
                <div class="form-group">
                    <label for="member-search">Buscar Membro</label>
                    <input type="text" id="member-search" class="form-control" placeholder="Digite o nome do membro">
                </div>
                
                <div class="form-group">
                    <label>Membros Selecionados</label>
                    <div id="selected-members" class="selected-members-container">
                        <p>Nenhum membro selecionado</p>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-primary" id="generate-cards-btn">
                        <i class="fas fa-id-card"></i> Gerar Carteirinhas
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de visualização de membro -->
    <div class="modal" id="member-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Detalhes do Membro</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="member-details-grid">
                    <div>
                        <img id="modal-photo" src="" alt="Foto do membro" class="member-photo-large">
                    </div>
                    <div>
                        <div class="details-section">
                            <h3>Informações Pessoais</h3>
                            <div class="detail-row">
                                <span class="detail-label">Nome:</span>
                                <span class="detail-value" id="modal-nome"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">CPF:</span>
                                <span class="detail-value" id="modal-cpf"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Data Nascimento:</span>
                                <span class="detail-value" id="modal-data-nascimento"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Nome da Mãe:</span>
                                <span class="detail-value" id="modal-mae"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Nome do Pai:</span>
                                <span class="detail-value" id="modal-pai"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Cônjuge:</span>
                                <span class="detail-value" id="modal-conjuge"></span>
                            </div>
                        </div>
                        
                        <div class="details-section">
                            <h3>Contato</h3>
                            <div class="detail-row">
                                <span class="detail-label">Telefone:</span>
                                <span class="detail-value" id="modal-telefone"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">E-mail:</span>
                                <span class="detail-value" id="modal-email"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Endereço:</span>
                                <span class="detail-value" id="modal-endereco"></span>
                            </div>
                        </div>
                        
                        <div class="details-section">
                            <h3>Informações Eclesiásticas</h3>
                            <div class="detail-row">
                                <span class="detail-label">Congregação:</span>
                                <span class="detail-value" id="modal-congregacao"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Cargo:</span>
                                <span class="detail-value" id="modal-cargo"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Data Batismo:</span>
                                <span class="detail-value" id="modal-data-batismo"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Data Entrada:</span>
                                <span class="detail-value" id="modal-data-entrada"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Status:</span>
                                <span class="detail-value" id="modal-status"></span>
                            </div>
                        </div>
                        
                        <div class="details-section">
                            <h3>Observações</h3>
                            <div class="detail-row">
                                <span class="detail-value" id="modal-observacao"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Sistema de Gestão - Igreja Adere Vidas &copy; 2023</p>
    </footer>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBNmIm9kem9yKp9skGS2HKHwqaauK36aps",
            authDomain: "dbaderevidas-9cbd0.firebaseapp.com",
            projectId: "dbaderevidas-9cbd0",
            storageBucket: "dbaderevidas-9cbd0.firebasestorage.app",
            messagingSenderId: "762500930740",
            appId: "1:762500930740:web:ff13ea2685e2db28ec0be1"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Elementos da interface
        const headerUsername = document.getElementById('header-username');
        const successAlert = document.getElementById('success-alert');
        const successMessage = document.getElementById('success-message');
        const errorAlert = document.getElementById('error-alert');
        const errorMessage = document.getElementById('error-message');
        const loadingMembers = document.getElementById('loading-members');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const memberModal = document.getElementById('member-modal');
        const closeModalBtn = document.querySelector('.close-modal');
        const pendingCount = document.getElementById('pending-count');
        
        // Variáveis globais
        let currentUser = null;
        let selectedTab = 'ativos';
        let allMembers = [];
        let selectedMembers = [];
        
        // Verificar se o usuário está logado
        document.addEventListener('DOMContentLoaded', function() {
            const userData = sessionStorage.getItem('user');
            
            if (!userData) {
                window.location.href = 'index.html';
                return;
            }
            
            currentUser = JSON.parse(userData);
            headerUsername.textContent = `Bem-vindo, ${currentUser.fullname}`;
            loadMembers();
            initCardGeneration();
            
            // Adicionar event listeners para as abas
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Ativar aba clicada
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Mostrar conteúdo correspondente
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-content`) {
                            content.classList.add('active');
                        }
                    });
                    
                    selectedTab = tabId;
                });
            });
            
            // Fechar modal
            closeModalBtn.addEventListener('click', closeModal);
        });
        
        // Adicionar funcionalidade ao botão de logout
        document.querySelector('.logout-btn').addEventListener('click', function() {
            if(confirm('Deseja realmente sair do sistema?')) {
                sessionStorage.removeItem('user');
                window.location.href = 'index.html';
            }
        });
        
        // Função para fechar o modal
        function closeModal() {
            memberModal.classList.remove('active');
        }
        
        // Carregar membros do Firestore
        async function loadMembers() {
            try {
                loadingMembers.style.display = 'block';
                
                // Limpar listas
                document.getElementById('ativos-list').innerHTML = '';
                document.getElementById('pendentes-list').innerHTML = '';
                document.getElementById('desligados-list').innerHTML = '';
                
                const membrosSnapshot = await db.collection('membros')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                if (membrosSnapshot.empty) {
                    document.getElementById('ativos-list').innerHTML = '<tr><td colspan="10" style="text-align: center;">Nenhum membro cadastrado</td></tr>';
                    document.getElementById('pendentes-list').innerHTML = '<tr><td colspan="10" style="text-align: center;">Nenhum membro pendente</td></tr>';
                    document.getElementById('desligados-list').innerHTML = '<tr><td colspan="10" style="text-align: center;">Nenhum membro desligado</td></tr>';
                    pendingCount.textContent = '0';
                    return;
                }
                
                allMembers = [];
                let pendentesCount = 0;
                
              membrosSnapshot.forEach(doc => {
    const membro = {
        id: doc.id,  // Usar o ID do documento do Firestore
        ...doc.data()
    };
    
    allMembers.push(membro);
    
    // Adicionar à tabela correspondente ao status
    if (membro.status === 'pendente') {
        addMemberToTable(membro, 'pendentes');
        pendentesCount++;
    } else if (membro.status === 'ativo') {
        addMemberToTable(membro, 'ativos');
    } else if (membro.status === 'desligado') {
        addMemberToTable(membro, 'desligados');
    }
});
                
                // Atualizar contador de solicitações pendentes
                pendingCount.textContent = pendentesCount;
                
            } catch (error) {
                console.error('Erro ao carregar membros:', error);
                showError('Erro ao carregar membros.');
            } finally {
                loadingMembers.style.display = 'none';
            }
        }
        
        // Adicionar membro à tabela
        function addMemberToTable(membro, tableType) {
            const tableBody = document.getElementById(`${tableType}-list`);
            
            // Formatar datas
            const dataEntrada = membro.dataEntrada ? 
                new Date(membro.dataEntrada).toLocaleDateString('pt-BR') : 
                'Não informada';
            
            // Criar linha da tabela
            const row = document.createElement('tr');
            
            // Determinar classe de status
            let statusClass = '';
            let statusText = '';
            
            switch(membro.status) {
                case 'ativo':
                    statusClass = 'status-ativo';
                    statusText = 'Ativo';
                    break;
                case 'pendente':
                    statusClass = 'status-pendente';
                    statusText = 'Pendente';
                    break;
                case 'desligado':
                    statusClass = 'status-desligado';
                    statusText = 'Desligado';
                    break;
            }
            
            row.innerHTML = `
                <td class="member-photo-cell">
                    <img src="${membro.foto || 'https://via.placeholder.com/60x80?text=Sem+Foto'}" 
                         alt="${membro.nome}" 
                         class="member-photo-small"
                         onclick="viewMember('${membro.id}')">
                </td>
                <td>${membro.nome || 'Não informado'}</td>
                <td>${membro.id || 'N/A'}</td>
                <td>${membro.telefone || 'Não informado'}</td>
                <td>${membro.email || 'Não informado'}</td>
                <td>${membro.congregacao || 'Não informada'}</td>
                <td>${membro.cargo || 'Não informado'}</td>
                <td>${dataEntrada}</td>
                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn btn-view" onclick="viewMember('${membro.id}')">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        ${membro.status === 'pendente' ? `
                            <button class="action-btn btn-accept" onclick="acceptMember('${membro.id}')">
                                <i class="fas fa-check"></i> Aceitar
                            </button>
                            <button class="action-btn btn-reject" onclick="rejectMember('${membro.id}')">
                                <i class="fas fa-times"></i> Recusar
                            </button>
                        ` : `
                            <button class="action-btn btn-edit" onclick="editMember('${membro.id}')">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            ${membro.status === 'ativo' ? `
                                <button class="action-btn btn-deactivate" onclick="updateMemberStatus('${membro.id}', 'desligado')">
                                    <i class="fas fa-user-times"></i> Desligar
                                </button>
                            ` : `
                                <button class="action-btn btn-activate" onclick="updateMemberStatus('${membro.id}', 'ativo')">
                                    <i class="fas fa-user-check"></i> Reativar
                                </button>
                            `}
                            <button class="action-btn btn-delete" onclick="deleteMember('${membro.id}')">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        `}
                    </div>
                </td>
            `;
            
            tableBody.appendChild(row);
        }
        
        // Visualizar detalhes do membro
        function viewMember(memberId) {
            const member = allMembers.find(m => m.id === memberId);
            
            if (!member) return;
            
            // Preencher modal com dados do membro
            document.getElementById('modal-photo').src = member.foto || 'https://via.placeholder.com/200x250?text=Sem+Foto';
            document.getElementById('modal-nome').textContent = member.nome || 'Não informado';
            document.getElementById('modal-cpf').textContent = member.cpf || 'Não informado';
            document.getElementById('modal-data-nascimento').textContent = member.dataNascimento ? 
                new Date(member.dataNascimento).toLocaleDateString('pt-BR') : 'Não informada';
            document.getElementById('modal-mae').textContent = member.mae || 'Não informado';
            document.getElementById('modal-pai').textContent = member.pai || 'Não informado';
            document.getElementById('modal-conjuge').textContent = member.conjuge || 'Não informado';
            document.getElementById('modal-telefone').textContent = member.telefone || 'Não informado';
            document.getElementById('modal-email').textContent = member.email || 'Não informado';
            document.getElementById('modal-endereco').textContent = member.endereco || 'Não informado';
            document.getElementById('modal-congregacao').textContent = member.congregacao || 'Não informada';
            document.getElementById('modal-cargo').textContent = member.cargo || 'Não informado';
            document.getElementById('modal-data-batismo').textContent = member.dataBatismo ? 
                new Date(member.dataBatismo).toLocaleDateString('pt-BR') : 'Não informada';
            document.getElementById('modal-data-entrada').textContent = member.dataEntrada ? 
                new Date(member.dataEntrada).toLocaleDateString('pt-BR') : 'Não informada';
            
            // Status
            let statusText = '';
            switch(member.status) {
                case 'ativo': statusText = 'Ativo'; break;
                case 'pendente': statusText = 'Pendente'; break;
                case 'desligado': statusText = 'Desligado'; break;
            }
            document.getElementById('modal-status').textContent = statusText;
            
            document.getElementById('modal-observacao').textContent = member.observacao || 'Nenhuma observação';
            
            // Abrir modal
            memberModal.classList.add('active');
        }
        
        // Aceitar membro (mover para ativos)
     async function acceptMember(customId) {
    if (!confirm('Tem certeza que deseja aceitar este membro?')) {
        return;
    }
    
    try {
        // Primeiro buscar o documento pelo ID personalizado
        const memberSnapshot = await db.collection('membros')
            .where('id', '==', customId)
            .get();
            
        if (memberSnapshot.empty) {
            throw new Error('Membro não encontrado');
        }
        
        // Obter o ID real do documento do Firestore
        const docId = memberSnapshot.docs[0].id;
        
        // Atualizar usando o ID real do documento
        await db.collection('membros').doc(docId).update({
            status: 'ativo',
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        successMessage.textContent = 'Membro aceito com sucesso!';
        successAlert.style.display = 'block';
        
        loadMembers();
        
    } catch (error) {
        showError('Erro ao aceitar membro: ' + error.message);
    }
}
        
        // Recusar membro (excluir)
        async function rejectMember(id) {
            if (!confirm('Tem certeza que deseja recusar este membro? Esta ação não pode ser desfeita.')) {
                return;
            }
            
            try {
                await db.collection('membros').doc(id).delete();
                
                successMessage.textContent = 'Membro recusado com sucesso!';
                successAlert.style.display = 'block';
                
                loadMembers();
                
            } catch (error) {
                showError('Erro ao recusar membro: ' + error.message);
            }
        }
        
        // Atualizar status do membro (ativo/desligado)
        async function updateMemberStatus(id, status) {
            const confirmMessage = status === 'desligado' ? 
                'Tem certeza que deseja desligar este membro?' : 
                'Tem certeza que deseja reativar este membro?';
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                await db.collection('membros').doc(id).update({
                    status: status,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                const action = status === 'desligado' ? 'desligado' : 'reativado';
                successMessage.textContent = `Membro ${action} com sucesso!`;
                successAlert.style.display = 'block';
                
                loadMembers();
                
            } catch (error) {
                showError('Erro ao atualizar status do membro: ' + error.message);
            }
        }
        
        // Excluir membro permanentemente
        async function deleteMember(id) {
            if (!confirm('Tem certeza que deseja excluir permanentemente este membro? Esta ação não pode ser desfeita.')) {
                return;
            }
            
            try {
                await db.collection('membros').doc(id).delete();
                
                successMessage.textContent = 'Membro excluído com sucesso!';
                successAlert.style.display = 'block';
                
                loadMembers();
                
            } catch (error) {
                showError('Erro ao excluir membro: ' + error.message);
            }
        }
        
        // Editar membro (para implementação futura)
        function editMember(id) {
            alert('Funcionalidade de edição em desenvolvimento');
        }
        
        // Inicializar funcionalidade de carteirinhas
        function initCardGeneration() {
            setupMemberSearch();
            
            document.getElementById('generate-cards-btn').addEventListener('click', function() {
                if (selectedMembers.length === 0) {
                    showError('Selecione pelo menos um membro para gerar carteirinhas.');
                    return;
                }
                generateCardsPDF();
            });
        }
        
        // Configurar busca de membros
        function setupMemberSearch() {
            const searchInput = document.getElementById('member-search');
            let searchResults = null;
            
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                
                // Remover resultados anteriores
                if (searchResults) {
                    searchResults.remove();
                }
                
                if (searchTerm.length < 2) {
                    return;
                }
                
                // Filtrar membros ativos
                const filteredMembers = allMembers.filter(member => 
                    member.nome && member.nome.toLowerCase().includes(searchTerm) && member.status === 'ativo'
                );
                
                if (filteredMembers.length === 0) {
                    return;
                }
                
                // Criar elemento de resultados
                searchResults = document.createElement('div');
                searchResults.className = 'search-results';
                
                filteredMembers.forEach(member => {
                    // Verificar se o membro já foi selecionado
                    if (selectedMembers.some(m => m.id === member.id)) {
                        return;
                    }
                    
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.textContent = member.nome;
                    
                    resultItem.addEventListener('click', function() {
                        addSelectedMember(member);
                        searchInput.value = '';
                        searchResults.remove();
                        searchResults = null;
                    });
                    
                    searchResults.appendChild(resultItem);
                });
                
                // Posicionar e exibir resultados
                searchInput.parentNode.appendChild(searchResults);
            });
            
            // Fechar resultados ao clicar fora
            document.addEventListener('click', function(e) {
                if (searchResults && !searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.remove();
                    searchResults = null;
                }
            });
        }
        
        // Adicionar membro à lista de selecionados
        function addSelectedMember(member) {
            // Verificar se já foi adicionado
            if (selectedMembers.some(m => m.id === member.id)) {
                return;
            }
            
            selectedMembers.push(member);
            renderSelectedMembers();
        }
        
        // Renderizar membros selecionados
        function renderSelectedMembers() {
            const container = document.getElementById('selected-members');
            container.innerHTML = '';
            
            if (selectedMembers.length === 0) {
                container.innerHTML = '<p>Nenhum membro selecionado</p>';
                return;
            }
            
            selectedMembers.forEach(member => {
                const memberEl = document.createElement('div');
                memberEl.className = 'selected-member';
                memberEl.innerHTML = `
                    <span>${member.nome}</span>
                    <button class="remove-member" data-id="${member.id}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                container.appendChild(memberEl);
            });
            
            // Adicionar event listeners aos botões de remover
            document.querySelectorAll('.remove-member').forEach(btn => {
                btn.addEventListener('click', function() {
                    const memberId = this.getAttribute('data-id');
                    removeSelectedMember(memberId);
                });
            });
        }
        
        // Remover membro da lista de selecionados
        function removeSelectedMember(memberId) {
            selectedMembers = selectedMembers.filter(member => member.id !== memberId);
            renderSelectedMembers();
        }
        
        // Gerar PDF das carteirinhas
        async function generateCardsPDF() {
            try {
                // Usando a biblioteca jsPDF para gerar o PDF
                const { jsPDF } = window.jspdf;
                
                // Configurar PDF no formato A4 (210x297mm) em modo retrato
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Carregar a logo da igreja
                const logoUrl = 'https://i.ibb.co/Ng3DKmJK/logo-igreja.png';
                
                // Tamanho da carteirinha em mm (9,6 cm x 5,5 cm = 96mm x 55mm)
                const cardWidth = 78;
                const cardHeight = 45;
                
                // Margens e espaçamento
                const margin = 15;
                const spacing = 5;
                
                // Calcular quantas carteirinhas cabem por página (2 por coluna)
                const cardsPerCol = 1;
                const cardsPerPage = cardsPerCol * 2; // 2 colunas (frente e verso) x 2 linhas
                
                // Data atual e data de validade (3 meses depois)
                const hoje = new Date();
                const dataValidade = new Date();
                dataValidade.setMonth(hoje.getMonth() + 3);
                
                const dataEmissaoFormatada = hoje.toLocaleDateString('pt-BR');
                const dataValidadeFormatada = dataValidade.toLocaleDateString('pt-BR');
                
                for (let i = 0; i < selectedMembers.length; i++) {
                    // Adicionar nova página se necessário
                    if (i > 0 && i % cardsPerPage === 0) {
                        doc.addPage();
                    }
                    
                    const member = selectedMembers[i];
                    const cardIndex = i % cardsPerPage;
                    
                    // Calcular posição na página - coluna da esquerda (frente)
                    const row = Math.floor(cardIndex / 2); // 0 ou 1
                    const col = cardIndex % 2; // 0 (esquerda) ou 1 (direita)
                    
                    const x = margin + col * (cardWidth + spacing);
                    const y = margin + row * (cardHeight + spacing);
                    
                    // CARTAZINHA DA FRENTE
                    // Desenhar moldura da carteirinha (frente) - Azul mais vibrante
                    doc.setDrawColor(0);
                    doc.setFillColor(25, 55, 109);
                    doc.roundedRect(x, y, cardWidth, cardHeight, 2, 2, 'F');
                    
                    // Borda dourada
                    doc.setDrawColor(212, 175, 55);
                    doc.setLineWidth(0.5);
                    doc.roundedRect(x, y, cardWidth, cardHeight, 2, 2);
                    
                    try {
                        // Adicionar logo da igreja (tamanho reduzido)
                        doc.addImage({
                            imageData: logoUrl,
                            x: x + 3,
                            y: y + 3,
                            width: 10,
                            height: 10
                        });
                    } catch (error) {
                        console.error('Erro ao carregar logo:', error);
                        // Placeholder se a logo não carregar
                        doc.setFillColor(255, 255, 255);
                        doc.roundedRect(x + 3, y + 3, 10, 10, 1, 1, 'F');
                        doc.setTextColor(25, 55, 109);
                        doc.setFontSize(5);
                        doc.text('IEAD', x + 8, y + 8, { align: 'center' });
                    }
                    
                    // Adicionar conteúdo da frente
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(6);
                    doc.setFont(undefined, 'bold'); // Texto em negrito
                    doc.text('MINISTÉRIO RESGATANDO VIDAS', x + cardWidth/2, y + 7, { align: 'center' });
                    
                    doc.setFontSize(4);
                    doc.setFont(undefined, 'normal'); // Voltar ao normal
                    doc.text('Rua Narcisa Amália, nº50 - Imbariê, Duque de Caxias', x + cardWidth/2, y + 10, { align: 'center' });
                    
                    // LINHA DIVISÓRIA DOURADA MAIS BAIXA (ajustada para y + 16)
                    doc.setDrawColor(212, 175, 55);
                    doc.setLineWidth(0.3);
                    doc.line(x + 5, y + 16, x + cardWidth - 5, y + 16);
                    
                    // Adicionar foto 3x4 reduzida (15x20mm) - COM BORDA FINA PRETA
                    if (member.foto) {
                        try {
                            // Moldura interna para a foto com borda fina preta
                            doc.setDrawColor(0, 0, 0); // Cor preta
                            doc.setLineWidth(0.3); // Borda mais fina
                            doc.setFillColor(255, 255, 255);
                            doc.roundedRect(x + cardWidth - 21, y + 20, 15, 20, 1, 1, 'F');
                            doc.roundedRect(x + cardWidth - 21, y + 20, 15, 20, 1, 1); // Desenhar borda
                            
                            // Adicionar a imagem
                            const img = new Image();
                            img.src = member.foto;
                            
                            await new Promise((resolve) => {
                                img.onload = resolve;
                            });
                            
                            doc.addImage({
                                imageData: member.foto,
                                x: x + cardWidth - 21,
                                y: y + 20,
                                width: 15,
                                height: 20
                            });
                        } catch (error) {
                            console.error('Erro ao adicionar foto:', error);
                            // Se houver erro, adicionar placeholder com borda fina preta
                            doc.setDrawColor(0, 0, 0);
                            doc.setLineWidth(0.3);
                            doc.setFillColor(240, 240, 240);
                            doc.roundedRect(x + cardWidth - 21, y + 20, 15, 20, 1, 1, 'F');
                            doc.roundedRect(x + cardWidth - 21, y + 20, 15, 20, 1, 1);
                            doc.setTextColor(150, 150, 150);
                            doc.setFontSize(4);
                            doc.text('FOTO', x + cardWidth - 13.5, y + 30, { align: 'center' });
                        }
                    } else {
                        // Placeholder se não houver foto com borda fina preta
                        doc.setDrawColor(0, 0, 0);
                        doc.setLineWidth(0.3);
                        doc.setFillColor(240, 240, 240);
                        doc.roundedRect(x + cardWidth - 21, y + 20, 15, 20, 1, 1, 'F');
                        doc.roundedRect(x + cardWidth - 21, y + 20, 15, 20, 1, 1);
                        doc.setTextColor(150, 150, 150);
                        doc.setFontSize(4);
                        doc.text('FOTO', x + cardWidth - 13.5, y + 30, { align: 'center' });
                    }
                    
                    // Adicionar detalhes do membro (frente) - TEXTO EM NEGRITO
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(5);
                    doc.setFont(undefined, 'bold'); // Texto em negrito
                    
                    // Textos completos restaurados - POSIÇÕES MAIS BAIXAS
                    doc.text(`ID: ${member.id || 'N/A'}`, x + 5, y + 20);
doc.text(`Nome: ${member.nome || 'N/A'}`, x + 5, y + 24);
doc.setFontSize(4);
doc.text(`Congregação: ${member.congregacao || 'N/A'}`, x + 5, y + 34);
doc.text(`Data de Batismo: ${member.dataBatismo ? new Date(member.dataBatismo).toLocaleDateString('pt-BR') : 'N/A'}`, x + 5, y + 31);
doc.text(`Data de Nascimento: ${member.dataNascimento ? new Date(member.dataNascimento).toLocaleDateString('pt-BR') : 'N/A'}`, x + 5, y + 28);
doc.text(`Cargo: ${member.cargo || 'N/A'}`, x + 5, y + 37);

// Status com cor diferenciada
doc.setFontSize(4.5);
if (member.status === 'ativo') {
    doc.setTextColor(144, 238, 144); // Verde claro para ativo
} else {
    doc.setTextColor(255, 165, 165); // Vermelho claro para inativo
}
doc.text(`Situação: ${member.status === 'ativo' ? 'ATIVO' : 'INATIVO'}`, x + 5, y + 40);
                    
                    // Data de validade (adicionada na parte inferior)
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(4);
                    doc.setFont(undefined, 'normal'); // Voltar ao normal
                    doc.text(`Validade: ${dataValidadeFormatada}`, x + cardWidth/2, y + cardHeight - 3, { align: 'center' });
                    
                    // CARTAZINHA DO VERSO (lado direito da página)
                    const versoX = x + cardWidth + spacing;
                    const versoY = y;
                    
                    // Desenhar moldura da carteirinha (verso) - Fundo branco com borda azul
                    doc.setDrawColor(25, 55, 109);
                    doc.setFillColor(255, 255, 255);
                    doc.roundedRect(versoX, versoY, cardWidth, cardHeight, 2, 2, 'F');
                    doc.setLineWidth(0.5);
                    doc.roundedRect(versoX, versoY, cardWidth, cardHeight, 2, 2);
                    
                    // Adicionar logo com opacidade baixa no fundo do verso
                    try {
                        // Salvar o estado atual do contexto gráfico
                        doc.saveGraphicsState();
                        
                        // Configurar transparência (opacidade baixa)
                        doc.setGlobalAlpha(0.15);
                        
                        // Adicionar logo no fundo com opacidade baixa
                        doc.addImage({
                            imageData: logoUrl,
                            x: versoX + cardWidth/2 - 15,
                            y: versoY + cardHeight/2 - 15,
                            width: 30,
                            height: 30
                        });
                        
                        // Restaurar o estado do contexto gráfico
                        doc.restoreGraphicsState();
                    } catch (error) {
                        console.error('Erro ao adicionar logo de fundo:', error);
                    }
                    
                    // Adicionar conteúdo do verso
                    doc.setTextColor(25, 55, 109);
                    doc.setFontSize(6);
                    doc.setFont(undefined, 'bold'); // Texto em negrito
                    doc.text('IEAD - RESGATANDO VIDAS', versoX + cardWidth/2, versoY + 7, { align: 'center' });
                    
                    doc.setFontSize(4.5);
                    doc.text('DOCUMENTO DE IDENTIFICAÇÃO', versoX + cardWidth/2, versoY + 10, { align: 'center' });
                    
                    // Linha divisória azul
                    doc.setDrawColor(25, 55, 109);
                    doc.setLineWidth(0.3);
                    doc.line(versoX + 5, versoY + 12, versoX + cardWidth - 5, versoY + 12);
                    
                    // Adicionar detalhes do membro (verso) - TEXTO EM NEGRITO
                    doc.setFontSize(4);
                    doc.setTextColor(0, 0, 0);
                    doc.text(`Pai: ${member.pai || 'N/A'}`, versoX + 5, versoY + 15);
                    doc.text(`Mãe: ${member.mae || 'N/A'}`, versoX + 5, versoY + 18);
                    doc.text(`Estado Civil: ${member.conjuge ? 'Casado(a)' : 'Solteiro(a)'}`, versoX + 5, versoY + 21);
                    doc.text(`Cônjuge: ${member.conjuge || 'N/A'}`, versoX + 5, versoY + 24);
                    doc.text(`CPF: ${member.cpf || 'N/A'}`, versoX + 5, versoY + 27);
                    doc.text(`Entrada: ${member.dataEntrada ? new Date(member.dataEntrada).toLocaleDateString('pt-BR') : 'N/A'}`, versoX + 5, versoY + 30);
                    
                    // Data de emissão
                    doc.text(`Emissão: ${dataEmissaoFormatada}`, versoX + 5, versoY + 33);
                    
                    // Linha de assinatura
                    doc.setDrawColor(0);
                    doc.setLineWidth(0.3);
                    doc.line(versoX + 10, versoY + 37, versoX + cardWidth - 10, versoY + 37);
                    doc.setFontSize(3.5);
                    doc.setFont(undefined, 'normal'); // Voltar ao normal
                    doc.text('Pastor Presidente: Cláudio Silva', versoX + cardWidth/2, versoY + 40, { align: 'center' });
                    doc.text('Assinatura', versoX + cardWidth/2, versoY + 42, { align: 'center' });
                }
                
                // Gerar URL do PDF e abrir em nova aba
                const pdfBlob = doc.output('blob');
                const pdfUrl = URL.createObjectURL(pdfBlob);
                window.open(pdfUrl, '_blank');
                
                successMessage.textContent = 'Carteirinhas geradas com sucesso! Abrindo em nova aba...';
                successAlert.style.display = 'block';
                
            } catch (error) {
                console.error('Erro ao gerar carteirinhas:', error);
                showError('Erro ao gerar carteirinhas: ' + error.message);
            }
        }
        
        // Função para exibir mensagem de erro
        function showError(message) {
            errorMessage.textContent = message;
            errorAlert.style.display = 'block';
            
            // Esconder após 5 segundos
            setTimeout(() => {
                errorAlert.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>